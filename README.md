# 二轮差速运动模型的ROS驱动

---

## 引言

本项目为完成一个轮椅的ROS驱动，以在该轮椅上实现导航的功能。
这也是我第一次在项目开发中使用git，我希望通过该项目，提高我对于git，以及Python、Markdown等工具的使用能力，同时有意识的提高代码的规范性，当然我也会再次强调，我觉得代码最核心的内容是代码本身，代码思想本身的简洁是最高的追求，此外，项目开发的效率也是放在首位的，技术只是服务。

## 计划

- 时间上来说，我希望在本周完成第一版本的驱动，起码能够成功的通过键盘控制轮椅移动，转速看着正确；争取在第二周跑通建图和导航算法。
- **Step by Step, But Efficiency**

## 理论

### 二轮差速运动模型的运动学公式如下


1. **轮子线速度**  
   左右轮的线速度分别由轮子半径 \( r \) 和角速度 \( \omega_{\text{left}} \)、\( \omega_{\text{right}} \) 决定：  
   \[
   v_{\text{left}} = r \cdot \omega_{\text{left}}, \quad v_{\text{right}} = r \cdot \omega_{\text{right}}
   \]

2. **机器人线速度**  
   机器人的整体线速度 \( v \) 为左右轮线速度的平均值：  
   \[
   v = \frac{v_{\text{left}} + v_{\text{right}}}{2} = \frac{r}{2} \left( \omega_{\text{left}} + \omega_{\text{right}} \right)
   \]

3. **机器人角速度**  
   角速度 \( \omega \) 由左右轮线速度差和轮距 \( L \) 决定：  
   \[
   \omega = \frac{v_{\text{right}} - v_{\text{left}}}{L} = \frac{r}{L} \left( \omega_{\text{right}} - \omega_{\text{left}} \right)
   \]

4. **位姿微分方程**  
   机器人位置 \((x, y)\) 和朝向 \(\theta\) 随时间的变化率：  
   \[
   \frac{dx}{dt} = v \cos\theta, \quad \frac{dy}{dt} = v \sin\theta, \quad \frac{d\theta}{dt} = \omega
   \]

5. **逆运动学公式**  
   根据期望的线速度 \( v \) 和角速度 \( \omega \)，计算左右轮角速度：  
   \[
   \omega_{\text{left}} = \frac{2v - L\omega}{2r}, \quad \omega_{\text{right}} = \frac{2v + L\omega}{2r}
   \]

6. **转弯半径**  
   瞬时转弯半径 \( R \)（当 \( \omega \neq 0 \) 时）：  
   \[
   R = \frac{v}{\omega}
   \]

**参数说明**：  

- \( L \): 轮距（左右轮中心距离）  
- \( r \): 轮子半径  
- \( \omega_{\text{left}}, \omega_{\text{right}} \): 左右轮角速度  
- \( v_{\text{left}}, v_{\text{right}} \): 左右轮线速度  
- \( v \): 机器人线速度  
- \( \omega \): 机器人角速度  
- \( \theta \): 机器人朝向角（相对于全局坐标系）  

这些公式完整描述了二轮差速驱动机器人的运动学关系，适用于运动控制、路径规划及状态估计等领域。

### 要点

- **运动学模型**
- **下位机通信控制**

要编写适配自己小车的ROS驱动代码，有两点，一是小车的运动学模型，比如二轮差速、四麦克纳姆驱动等，他们有各自的运动学理论公式，如二轮差速模型的运动学公式如上，有了这些公式，即可由小车期望速度计算出具体驱动轮的转速（有的还有舵机的偏转等），进而下发到下位机实现对cmd vel话题的处理。通过运动学公式，对从下位机读取的实际驱动轮转速（舵机等实际驱动小车运动的驱动器），计算出实际的小车的速度，进而求解出里程计信息并发布（还有tf变换），里程计信息的计算公式是比较简单且通用的积分。所以分析出小车的运动学模型，得到相应的运动学公式非常重要，是第一个要点。
第二个要点那就是下位机的通信了，这与你所使用的控制器就息息相关了。具体来说就是你怎样让驱动器按照你期望的方式运作起来，且还能读取它实际的运动状态。如本例中的如何让左右轮按照期望的转速运转，如何实时读取其实际的转速。
